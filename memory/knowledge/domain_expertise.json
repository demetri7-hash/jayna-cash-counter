{
  "domains": {
    "database_schema_first_principle": {
      "concepts_learned": [
        "ALWAYS reference existing database schema before writing new code",
        "Database schema is the SINGLE SOURCE OF TRUTH",
        "Never invent field names - look them up in existing load/save functions",
        "Field name mismatches cause silent failures that are hard to debug",
        "Existing patterns contain the correct schema (loadChecklistFromDatabase, saveChecklistToDatabase)"
      ],
      "tools_used": ["Grep", "Read tool", "Supabase schema"],
      "patterns_identified": [
        "WRONG APPROACH: Write code â†’ invent field names â†’ test â†’ debug field name errors",
        "RIGHT APPROACH: Read existing load function â†’ copy exact field names â†’ write new code",
        "Checklist schema (from loadChecklistFromDatabase line 715-718): section.name, task.text, task.is_required",
        "Session task schema (from database): section_title, task_description, required, requires_photo",
        "When merging data from definition â†’ session, field names MUST match exactly"
      ],
      "resources": [
        "foh-checklists.html line 651-746: loadChecklistFromDatabase() - SOURCE OF TRUTH for checklist structure",
        "foh-checklists.html line 751-860: saveChecklistToDatabase() - SOURCE OF TRUTH for save format",
        "Database tables: checklist_definitions, checklist_sections, checklist_section_tasks, foh_checklist_tasks"
      ],
      "notes": [
        "CRITICAL MISTAKE (Oct 30, 2025): Used task.description instead of task.text, section.title instead of section.name",
        "IMPACT: Merge logic built list of undefined values, failed silently, new tasks never appeared",
        "LESSON: Before writing ANY code that touches database records, READ the existing load/save functions FIRST",
        "User quote: 'learn a lesson from this about making things up when the actual database schema is completely available to you at all times'",
        "This wasted hours of debugging when 2 minutes of reading existing code would have prevented it",
        "PROTOCOL: 1) Find existing load function, 2) Read it completely, 3) Document field names, 4) Use EXACT names in new code",
        "Field name reference guide:",
        "  Checklist definition: type, title, time_range, description, staff_count, has_ratings, has_notes, has_photos, rating_scale, start_hour, start_minute, end_hour, end_minute",
        "  Section object: name (NOT title), description, type (section_type in DB)",
        "  Task object: text (NOT description), is_required (NOT required)",
        "  Session task DB: section_title, task_description, task_order, completed, required, requires_photo",
        "ALWAYS use Grep to find load functions: grep -n 'async function load.*FromDatabase' filename.html"
      ]
    },
    "restaurant_management": {
      "concepts_learned": [
        "AM/PM cash counting workflows",
        "Dual drawer systems",
        "Whole-dollar deposit rounding",
        "Tip pool equity distribution",
        "FOH checklist management",
        "Toast POS integration patterns"
      ],
      "tools_used": ["Toast POS API", "Supabase", "EmailJS", "Homebase API"],
      "patterns_identified": [
        "Smart time-based routing (7AM-7PM = AM, 7PM-2AM = PM)",
        "Session-based password protection (30-min cash, 60-min manager)",
        "Pacific timezone handling for all time calculations",
        "Database-driven dynamic loading (no hardcoded filters)",
        "Safe DOM manipulation with unique IDs",
        "Pure createElement() pattern instead of innerHTML"
      ],
      "resources": [
        "CLAUDE.md - Project guidelines",
        "CURRENT_STATUS.md - Current work state",
        "PROJECT_MASTER_LOG.md - Session history",
        "AI_PROJECT_INSTRUCTIONS.md - Complete project context"
      ],
      "notes": [
        "User prefers autonomous execution without asking",
        "Always use existing patterns before creating new ones",
        "Never remove code to fix errors - fix the root cause",
        "No popup windows (alert/confirm/prompt) - use inline feedback",
        "Document all changes in CURRENT_STATUS.md at session end"
      ]
    },
    "toast_pos_api": {
      "concepts_learned": [
        "Void detection at 4 levels (order, check, selection, payment)",
        "Net sales calculation using check.amount",
        "Full pagination required (100 orders per page)",
        "Partial refunds vs full voids",
        "Gratuity vs non-gratuity service charges"
      ],
      "tools_used": ["Toast Orders API v2", "Toast Payments API"],
      "patterns_identified": [
        "Always check both order.voided AND check.voided",
        "Use check.amount for net sales (not sum of payments)",
        "Paginate with while loop until orders.length < 100",
        "Rate limit: 300ms delay between requests"
      ],
      "resources": ["toast-orders-testing.html", "comprehensive-analysis.html"],
      "notes": [
        "TDS Driver GUID: 5ffaae6f-4238-477d-979b-3da88d45b8e2",
        "Restaurant GUID: d3efae34-7c2e-4107-a442-49081e624706 (env var)"
      ]
    },
    "supabase_database": {
      "concepts_learned": [
        "JSONB storage for denomination counts",
        "RLS policies for storage buckets",
        "Single record per date pattern (cash_counts)",
        "Session-based data (foh_checklist_sessions)",
        "Photo storage with public bucket"
      ],
      "tools_used": ["Supabase JS Client", "PostgreSQL"],
      "patterns_identified": [
        "Use .single() for unique date records",
        "Handle PGRST116 error (no rows) gracefully",
        "Store complex data as JSONB (drawer counts, checklist tasks)",
        "Use storage.objects for file uploads"
      ],
      "resources": ["sql/storage_policies.sql"],
      "notes": [
        "cash_counts table: single record per date with am_* and pm_* columns",
        "foh_checklist_sessions: tracks checklist completion",
        "Storage bucket: foh-checklist-photos (public, 5MB limit)"
      ]
    },
    "vercel_deployment": {
      "concepts_learned": [
        "Auto-deploy from main branch",
        "Serverless functions in /api folder",
        "Environment variables via dashboard",
        "1-2 minute deploy time"
      ],
      "tools_used": ["Vercel CLI", "Git"],
      "patterns_identified": [
        "Commit â†’ push â†’ auto-deploy",
        "Test locally with python3 -m http.server 8000",
        "Always verify after deploy at production URL"
      ],
      "resources": [],
      "notes": [
        "Production URL: https://jayna-cash-counter-git-main-demetri-gregorakis-projects.vercel.app",
        "NEVER commit .env files",
        "Create ARCHIVE backup before major changes"
      ]
    },
    "ezcater_api": {
      "concepts_learned": [
        "GraphQL introspection to discover real API schema",
        "Webhook event subscriptions via createEventNotificationSubscription",
        "Customer data stored in event.contact.name (NOT orderCustomer fields)",
        "Order ID resolution (order number â†’ UUID via multiple format attempts)",
        "4 webhook event types: submitted, accepted, rejected, cancelled",
        "Google Sites sandbox restrictions (no window.prompt/alert/confirm)"
      ],
      "tools_used": ["EZCater GraphQL API", "Vercel Serverless Functions", "Supabase catering_orders table"],
      "patterns_identified": [
        "Use introspection query to discover __schema instead of guessing fields",
        "createEventNotificationSubscription replaces deprecated createSubscriber/createSubscription",
        "parseOrderData checks event.contact.name first, then orderCustomer.fullName fallback",
        "import-by-number tries 3 ID formats: direct, without leading zeros, numeric cast",
        "Modal input pattern for Google Sites: createElement div overlay with input + buttons",
        "Webhook handler: receive event â†’ fetch full order â†’ parse â†’ upsert to Supabase",
        "Check for existing orders before importing to avoid duplicates"
      ],
      "resources": [
        "EZCATER_API_CAPABILITIES.md",
        "EZCATER_FINAL_SETUP.md",
        "EZCATER_SCHEMA_DISCOVERY.md",
        "api/ezcater-introspect.js - GraphQL schema discovery",
        "api/ezcater-list-subscriptions.js - Verify webhook config",
        "api/ezcater-import-by-number.js - Import by order number (not UUID)",
        "api/fix-customer-names.js - Retroactive customer name fix"
      ],
      "notes": [
        "API Token format: base64(email:api_key)",
        "Webhook URL: https://jayna-cash-counter.vercel.app/api/ezcater-webhook",
        "All 4 subscriptions must be created separately (one mutation per event type)",
        "Customer name location: order.event.contact.name (critical for all imports)",
        "Order structure: order â†’ event â†’ contact/address/catererHandoffFoodTime",
        "Order structure: order â†’ totals â†’ customerTotalDue/tip/salesTax/subTotal (subunits)",
        "Order structure: order â†’ catererCart â†’ orderItems (array of menu items)",
        "UUID discovery: try multiple formats because EZCater API accepts various ID formats",
        "Supabase constraint: unique(source_system, external_order_id) prevents duplicates",
        "User feedback: 'stop guessing, read docs, use introspection' - CRITICAL LESSON"
      ]
    },
    "css_styling_architecture": {
      "concepts_learned": [
        "CSS class vs inline style conflicts",
        "!important usage to resolve specificity wars",
        "Scoped button classes to avoid global conflicts",
        "User intentional design choices (Manager Logs button)",
        "Shared vs page-specific navigation patterns"
      ],
      "tools_used": ["CSS", "inline styles", "shared-header.js"],
      "patterns_identified": [
        "index.html: Uses .menu-btn CSS class + inline styles (CONFLICT - fixed with !important)",
        "FOH/BOH/Catering/Manager: Use shared-header.js for navigation (consistent)",
        "drivers.html: Should use shared-header.js + match base CSS from other pages",
        "Manager Logs button: Intentionally smaller design (6px padding, font-weight 600)",
        "Base CSS must match across ALL pages: font-family 'Aptos', same CSS variables, same body/container styling"
      ],
      "resources": [
        "shared-header.js - Dynamic navigation header",
        "index.html - Has own navigation with .menu-btn class",
        "foh-checklists.html - Reference for base CSS structure"
      ],
      "notes": [
        "CRITICAL: When creating new pages, copy base CSS from foh-checklists.html, NOT create from scratch",
        "CRITICAL: Use scoped class names (e.g., .driver-button) NOT global selectors (e.g., button {})",
        "CRITICAL: Manager Logs button is intentionally different - DO NOT standardize it",
        "index.html .menu-btn CSS fights with inline styles - use !important in CSS to win",
        "All navigation buttons: 16px padding, 11px font, 50px min-height, 1.2px letter-spacing",
        "Alternating color pattern: light (gray-100/gray-300) and dark (gray-700/white text)",
        "Font-family MUST be: 'Aptos', 'Segoe UI Variable', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif"
      ]
    },
    "catering_prep_list_logic": {
      "concepts_learned": [
        "BYO Gyro prep items have portion-based container thresholds",
        "Coordinated brown bowl logic for visual consistency",
        "Container types: 16oz deli, 32oz deli, brown bowls, half pans, full pans",
        "Different portion thresholds per item (tomatoes: 30/pan, onions: 50/pan, etc.)",
        "Bidirectional coordination: if ANY item in group gets brown bowl, ALL get brown bowls"
      ],
      "tools_used": ["catering.html prep list generator", "PDF label generation"],
      "patterns_identified": [
        "Two locations must stay in sync: HTML display (line 3171+) and PDF labels (line 3966+)",
        "Coordinated items: Tomatoes, Onions, Pepperoncini must use matching containers",
        "Check natural thresholds FIRST, then apply coordination flag",
        "Container escalation: deli â†’ brown bowl â†’ half pan â†’ full pan",
        "Proteins have separate scaling logic (5-portion threshold for brown bowls)"
      ],
      "resources": [
        "catering.html lines 3171-3248: BYO Gyro prep list HTML display logic",
        "catering.html lines 3966-4066: BYO Gyro PDF label generation logic",
        "catering.html lines 3067-3071: Protein container logic (brown bowls <5 portions)"
      ],
      "notes": [
        "SESSION: Nov 2, 2025 - Fixed coordinated brown bowl logic",
        "ORIGINAL BUG: Only checked if tomatoes use brown bowl, then forced others to match",
        "PROBLEM: At 24 portions, onions get brown bowl but tomatoes/pepperoncini get half pans",
        "FIX: Check if tomatoes (10-20) OR onions (20-45) naturally get brown bowl â†’ flag all three",
        "RESULT: At 24 portions, onions trigger flag â†’ all three get brown bowls for consistency",
        "CRITICAL: Always update BOTH sections when changing container logic (HTML + PDF labels)",
        "User quote: 'WHEN ONE of those three items calls for a brown bowl, the other two items also get a brown bowl'",
        "Bidirectional coordination prevents mismatched containers in prep list"
      ]
    },
    "toast_catering_date_timezone": {
      "concepts_learned": [
        "Toast API returns promisedDate in UTC format",
        "Must convert UTC to Pacific timezone BEFORE extracting date",
        "Timezone bug causes orders to appear on wrong day (off by 1)",
        "Pacific timezone critical for California-based restaurant"
      ],
      "tools_used": ["Toast Catering Orders API", "JavaScript Date timezone conversion"],
      "patterns_identified": [
        "WRONG: Split promisedDate on 'T' to get date â†’ gets UTC date, not Pacific",
        "RIGHT: Convert to Pacific timezone first, then extract YYYY-MM-DD",
        "Use: new Date(utc).toLocaleString('en-US', { timeZone: 'America/Los_Angeles' })",
        "Example bug: 9pm Pacific = 5am UTC next day â†’ split gives wrong date"
      ],
      "resources": [
        "api/toast-catering-orders.js lines 241-256: Fixed timezone conversion logic"
      ],
      "notes": [
        "SESSION: Nov 2, 2025 - Fixed critical date bug in catering orders",
        "USER REPORT: Order due Tuesday Nov 4th in Toast shows as Wednesday Nov 5th in app",
        "User quote: 'im afraid i cant trust it if its oing to be like this' - high priority/critical",
        "ROOT CAUSE: const promisedDateStr = order.promisedDate.split('T')[0]; (line 247 old code)",
        "This extracted UTC date without timezone conversion",
        "FIX: Convert promisedDate to Pacific timezone, then format as YYYY-MM-DD",
        "Added logging: console.log('ðŸ“… Date conversion: UTC=... â†’ Pacific=...')",
        "CRITICAL: All date/time handling must use Pacific timezone for accuracy"
      ]
    },
    "repository_organization": {
      "concepts_learned": [
        "Systematic collateral archiving to keep repo clean",
        "Protect critical folders (memory/, chat sessions/)",
        "Separate testing tools from production deployment files",
        "Use .gitignore to exclude local-only archives",
        "Comprehensive scanning before moving files"
      ],
      "tools_used": ["Glob", "Grep", "Bash", "Git"],
      "patterns_identified": [
        "ARCHIVE STRATEGY: Create COLLATERAL_ARCHIVE/ with organized subdirectories",
        "FOLDER STRUCTURE: {testing-tools, guides-documentation, emailjs-templates, test-pdfs, old-md-docs, sql-files, csv-data, screenshots, backup-files, test-scripts, misc, folders}",
        "PROTECTED FOLDERS: memory/ (external brain), chat sessions/ (RTF history), api/ (deployment), scripts/, database/, supabase/, docs/, sql/",
        "ACTIVE FILES: 12 HTML deployment pages, 6 essential markdown docs, 2 logo images",
        "GIT PROTECTION: Add COLLATERAL_ARCHIVE/ to .gitignore (local only, not pushed)"
      ],
      "resources": [
        "COLLATERAL_ARCHIVE/ - Archive folder with 204 files + 11 folders (25MB)",
        ".gitignore - Excludes COLLATERAL_ARCHIVE from git",
        "COLLATERAL_ARCHIVE_PLAN.txt - Detailed inventory of what was moved"
      ],
      "notes": [
        "SESSION: Nov 1, 2025 - Massive repo cleanup (204 files + 11 folders archived)",
        "USER REQUEST: 'scan ALL HTML FILES for ALL REFERENCES TO collateral... be very careful!!!!'",
        "APPROACH: 1) Scan HTML for collateral refs (none found), 2) Identify active vs testing files, 3) Move systematically",
        "CRITICAL PROTECTION: memory/ folder is external brain system - NEVER touch",
        "CRITICAL PROTECTION: 'chat sessions/' folder has RTF conversation history - NEVER touch",
        "ARCHIVED FILES TYPES:",
        "  - 9 testing/debug HTML (comprehensive-analysis, toast-orders-testing, etc.)",
        "  - 5 guide HTML (staff guides, ordering system guides)",
        "  - 3 EmailJS templates",
        "  - 23 test PDFs (prep sheets, orders, sales summaries)",
        "  - 50 old markdown docs (kept 6 essential only)",
        "  - 5 SQL files, 2 CSV files, 6 screenshots, 2 backups, 2 test scripts, 3 misc",
        "ARCHIVED FOLDERS:",
        "  - BOH/, FOH/ (training docs)",
        "  - DEPRECATED/ (old code)",
        "  - GREENLEAF PENDING ORDERS/, PERFORMANCE/, sales summaries (old data)",
        "  - training/, SOPs/ (documentation)",
        "  - orders/ (old React app not referenced in deployment)",
        "RESULT: Clean root with only production files, all archives accessible locally",
        "NO DEPLOYMENT IMPACT: Zero references to archived files in active pages",
        "User satisfied - repo organized, nothing broken"
      ]
    }
  }
}
